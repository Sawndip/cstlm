\documentclass{article}

\usepackage{a4wide}
\usepackage{palatino}
\usepackage{amsmath}
\usepackage{ifthen}
\usepackage{xspace}
\usepackage{booktabs}
\usepackage{algorithm}
\usepackage{algorithmicx}
\usepackage{scalerel}
\usepackage{scalerel}
\usepackage[noend]{algpseudocode}

\newcommand*\Let[2]{\State #1 $\gets$ #2}
\newcommand*\CSA{\textsc{Csa}\xspace}
\newcommand*\CST{\textsc{Cst}\xspace}
\algrenewcommand\algorithmicrequire{\textbf{Precondition:}}
\algrenewcommand\algorithmicensure{\textbf{Postcondition:}}

\newcommand{\leaf}[2]{\text{leaf}(#1, #2)}
\newcommand{\depth}[2]{\text{depth}(#1, #2)}
\newcommand{\degree}[2]{\text{degree}(#1, #2)}
\newcommand{\edge}[3]{\text{edge}(#1, #2, #3)}
\newcommand{\children}[2]{\text{children}(#1, #2)}
\newcommand{\backwardsearch}[4]{\text{backward-search}(#1, [#2,#3], #4)}
%\newcommand{\forwardsearch}[4]{\text{forward-search}(#1, [#2,#3], #4)}
\newcommand{\intervalsymbols}[3]{\text{interval-symbols}(#1, [#2,#3])}

\DeclareMathOperator*{\Bigcdot}{\scalerel*{\cdot}{\bigodot}}

\newcommand{\lb}[1]{\text{lb}(#1)}
\newcommand{\rb}[1]{\text{rb}(#1)}
\newcommand{\dotpat}{\Bigcdot \alpha}
\newcommand{\patdot}{\alpha \Bigcdot}
\newcommand{\dotpatdot}{\Bigcdot \alpha \Bigcdot}
\newcommand{\nlplus}[1]{N^{1+}(#1)} % note it's an little L in \nlplus not a 1

\newcommand{\tf}{t_{\text{F}}}
\newcommand{\tr}{t_{\text{R}}}
\newcommand{\af}{a_{\text{F}}}
\newcommand{\ar}{a_{\text{R}}}
\newcommand{\nf}{n_{\text{F}}}
\newcommand{\nr}{n_{\text{R}}}
\newcommand{\chf}{c_{\text{F}}}
\newcommand{\chr}{c_{\text{R}}}



\title{Draft paper for CST LM work for submission to EMNLP}
\date{\vspace{-5ex}\today}

\begin{document}

\maketitle 

\begin{algorithm}
  \caption{Compute one-sided occurrence counts, $\nlplus{\dotpat}$ or $\nlplus{\patdot}$ for pattern string $\alpha$ 
    \label{alg:n1plus}}
  \begin{algorithmic}[1]
    \Require{$n$ is the node in the \CST $t$ matching pattern $\alpha$}
    \Function{N1Plus}{$t, n, \alpha$} \Comment{ $t$ is either forward or reverse \CST}
        \Let{$o$}{$0$} \Comment{yielding $\nlplus{\patdot}$ or $\nlplus{\dotpat}$, respectively}
        \If{$\leaf{t}{n} \, \wedge \, \depth{t}{n} = |\alpha|$}
          \Let{$o$}{$\degree{t}{n}$}
        \Else
          \Let{$o$}{$1$}
        \EndIf
      \State \Return{$o$}
    \EndFunction
  \end{algorithmic}
\end{algorithm}

\begin{algorithm}
  \caption{Compute two-sided occurrence counts, $\nlplus{\dotpatdot}$ 
    \label{alg:n1plusfb}}
  \begin{algorithmic}[1]
    \Require{$\nf$ is the node in the forward \CST $\tf$ matching pattern $\alpha$}
    \Require{$\nr$ is the node in the reverse \CST $\tr$ matching pattern $\alpha$}
    \Function{N1PlusFrontBack}{$\tf, \nf, \alpha$} 
        \Let{$o$}{$0$}
        \If{$\leaf{\tf}{\nf} \, \vee \, \depth{\tf}{\nf} > |\alpha|$}   \Comment{leaves and patterns internal to an edge}
          \Let{$o$}{$\textsc{N1Plus}(\tr, \nr, \dotpat)$} \Comment{in forward \CST have only one right context}
        \Else
           \For{$\chf \gets \children{\tf}{\nf}$} 
              \Let{$s$}{$\edge{\tf}{\chf}{1}$} \Comment{find the first symbol on the edge label}
              \Let{$\chr$}{$\backwardsearch{\ar}{\lb{\nr}}{\rb{\nr}}{s}$} \Comment{find child node in reverse \CST}
              \Statex    \Comment{$\ar$ is the \CSA component of $\tr$}
              \Let{$o$}{$o + \textsc{N1Plus}(\tr, \chr, \dotpat s)$}
            \EndFor
        \EndIf
      \State \Return{$o$}
    \EndFunction
  \end{algorithmic}
\end{algorithm}

\begin{algorithm}
  \caption{Compute backward occurrence counts, $\nlplus{\patdot}$, using only forward \CST 
    \label{alg:n1plusback_wt}}
  \begin{algorithmic}[1]
    \Require{$\nf$ is the node in the forward \CST $\tf$ matching pattern $\alpha$}
    \Require{the \CSA component, $\af$ of $\tf$ is a wavelet tree}
    \Function{N1PlusBack}{$\tf, \nf, \alpha$} 
    \Let{$S$}{$\intervalsymbols{\af}{\lb{\nf}}{\rb{\nf}}$}
    \State \Return{$|S|$}
    \EndFunction
  \end{algorithmic}
\end{algorithm}

\begin{algorithm}
  \caption{Compute two-sided occurrence counts, $\nlplus{\dotpatdot}$, using only forward \CST 
    \label{alg:n1plusfb_wt}}
  \begin{algorithmic}[1]
    \Require{$\nf$ is the node in the forward \CST $\tf$ matching pattern $\alpha$}
    \Require{the \CSA component, $\af$ of $\tf$ is a wavelet tree}
    \Function{N1PlusFrontBack'}{$\tf, \nf, \alpha$} 
        \Let{$o$}{$0$}
        \If{$\leaf{\tf}{\nf} \, \vee \, \depth{\tf}{\nf} > |\alpha|$}   
          \Let{$o$}{$\textsc{N1Plus}(\tr, \nr, \dotpat)$}
        \Else
            \For{$\langle l, r, s\rangle \gets \intervalsymbols{\af}{\lb{\nf}}{\rb{\nf}}$}
              \State Some voodoo with Weiner links
               \Let{$o$}{$o +$ something}
            \EndFor
          \EndIf
      \State \Return{$o$}
    \EndFunction
  \end{algorithmic}
\end{algorithm}

\end{document}
